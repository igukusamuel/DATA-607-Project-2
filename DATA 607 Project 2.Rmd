---
title: "DATA 607 Project 2"
author: "Samuel I Kigamba"
date: "October 06, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

DATA 607 - Project 2
The goal of this assignment is to give you practice in preparing different datasets for downstream
analysis work.
Your task is to:
(1) Choose any three of the "wide" datasets identified in the Week 5 Discussion items. (You may
use your own dataset; please don't use my Sample Post dataset, since that was used in your
Week 6 assignment!) For each of the three chosen datasets:
??? Create a .CSV file (or optionally, a MySQL database!) that includes all of the information
included in the dataset. You're encouraged to use a "wide" structure similar to how the
information appears in the discussion item, so that you can practice tidying and
transformations as described below.
??? Read the information from your .CSV file into R, and use tidyr and dplyr as needed to
tidy and transform your data. [Most of your grade will be based on this step!]
??? Perform the analysis requested in the discussion item.
??? Your code should be in an R Markdown file, posted to rpubs.com, and should include
narrative descriptions of your data cleanup work, analysis, and conclusions.
(2) Please include in your homework submission, for each of the three chosen datasets:
??? The URL to the .Rmd file in your GitHub repository, and
??? The URL for your rpubs.com web page.


#set working directory and Install all the relevant packages and load their respective libraries into R.
```{r, include=FALSE}
getwd()
setwd("C:/Users/iguku/Google Drive/R and SQL/CUNY MSc Data Science/Data 607/Project 2")
```

```{r include=FALSE}
library(stringr)
library(tidyr)
library(dplyr)
library(tidyverse)
library(tibble)
library(caret)
library(readr)
```

# Upload the data into Github for ease of accessibility and testing by a wider audience.
Follow this link to see uploaded Male migrants .csv file (https://raw.githubusercontent.com/igukusamuel/DATA-607-Project-2/master/UN_MigrantStockMale_2019.csv)

```{r}
male_migrants <- read_csv("https://raw.githubusercontent.com/igukusamuel/DATA-607-Project-2/master/UN_MigrantStockMale_2019.csv")

#view(head(male_migrants, 20)) # vIew data frame structure and see how many rows to skip.
```

# As part of data cleanup, skip the first 15 rows that include source information nor relevant to out analysis.

```{r}
male_migrants <- read_csv("https://raw.githubusercontent.com/igukusamuel/DATA-607-Project-2/master/UN_MigrantStockMale_2019.csv", skip = 15)

head(male_migrants, 20) #Print out first 20 rows to confirm that the data have been loaded correctly.
```

# Careful review of the data shows that column named X6 only includes data for rows related to countries and N/A's for rows relating to regions and regional totals. Thus filtering out all N/As in column X6 will leave us with country data only, which is the basis of out analysis. We first view all the N/As under column X6 to confirm none of them relate to country information.

```{r}
colX6 <- filter(male_migrants, is.na(X6))

x <- length(colX6)

head(colX6, x)

```


# We then exclude all N/A's in column X6 and print out the first 6 rows using the head() function.

```{r}
male_migrants_by_country <- filter(male_migrants, !is.na(X6))

head(male_migrants_by_country)
```

# From the above print out, there is need to rename column X1 and X3 as year and country_to respectively.
```{r}
male_migrants_by_country <- male_migrants_by_country %>% 
        rename(
                year = X1,
                country_to = X3
        )
head(male_migrants_by_country)
```

#The above printout shows a number of irrelevant columns that are not necessary for our analysis. Lets print out the entire column names and delete the unnecessary ones to have a cleaner data set.
```{r}
colnames(male_migrants_by_country)
```

#The above print out reveals that we do not need all column names that start with "X", "Total" or "Other". We delete these columns using the srtarts_with function.

```{r}
male_migrants_by_country <- male_migrants_by_country %>% 
        select(-starts_with("X"), -starts_with("Other"), -starts_with("Total"))

head(male_migrants_by_country)
```

#We use dim() function to have an idea of how many rows and columns we have for our analysis.
```{r}
dim(male_migrants_by_country)
```

# The print out below is a confrimation of the column names. This is what we need for our analysis.

```{r}
colnames(male_migrants_by_country)
```


# GEt the length of the column names to be used in the next line of code.
```{r}
y <- length(colnames(male_migrants_by_country))

y 
```

#Let us use gather() function to gather all columns with country names from the 3rd column spanning the entire length of the columns into a single column and exclude any and all N/As to obtain clean data.
```{r}
no_of_migrants_per_country <- gather(male_migrants_by_country, "country_from", "no_of_migrants", 3:y, na.rm = TRUE)

no_of_migrants_per_country
```

#convert the no_of_migrants data column from characters to doubles for statistical analysis. This we will do using the parse_number() function. Print out using head() function the first 6 rows and confirm this conversion.

```{r}
no_of_migrants_per_country$no_of_migrants <- parse_number(no_of_migrants_per_country$no_of_migrants)

clean_male_data <- no_of_migrants_per_country

head(clean_male_data)
```

# Let us perform some statistical analysis by:

#Ordering data by country with largest inflow of male migrants

```{r}
by_country_to <- clean_male_data %>% 
        group_by(year, country_from, country_to) %>% 
        summarise(total_male_migrants = sum(no_of_migrants)) %>% 
        arrange(desc(total_male_migrants))
head(by_country_to)
```

#Ordering the data by the total no of male migrants since 1995 to 2019.

```{r}
total_migrants_since_1995 <- clean_male_data %>% 
        group_by(country_from, country_to) %>% 
        summarise(total_male_migrants = sum(no_of_migrants)) %>% 
        arrange(desc(total_male_migrants))
head(total_migrants_since_1995)
```

# Ordering the data by the countries sending out the least number of migrants
```{r}
least_no_migrants_from <- clean_male_data %>% 
        group_by(country_from) %>% 
        summarise(total_migrants_since_1995 = sum(no_of_migrants)) %>% 
        arrange(total_migrants_since_1995)
head(least_no_migrants_from)
```

#Ordering the data by the countries receiving the largest number of imigrants since 1995.

```{r}
largest_no_migrants_to <- clean_male_data %>% 
        group_by(country_to) %>% 
        summarise(total_migrants_since_1995 = sum(no_of_migrants)) %>% 
        arrange(desc(total_migrants_since_1995))
head(largest_no_migrants_to)
```

# Ordering the data by the countries receiving the least number of imigrants since 1995.

```{r}
least_no_migrants_to <- clean_male_data %>% 
        group_by(country_to) %>% 
        summarise(total_migrants_since_1995 = sum(no_of_migrants)) %>% 
        arrange(total_migrants_since_1995)

head(least_no_migrants_to)
```

#Conclusion: 
#The top 5 countries receiving the largest mumber of male migrants are USA, Rusia Federation, Saudi Arabia, GErmany and France
#The top 5 countries receiving the least mumber of male migrants are Tivalu, Saint Helena, Tokelau, Niue and Saint Pierre and Miqueton






Women migrants

The second section will involve replicating the code above to analyse the immigration data on women migrants. This will serve as a confirmation of the replicability of the code to similar data.

Follow this link to see uploaded female migrants .csv file (https://raw.githubusercontent.com/igukusamuel/DATA-607-Project-2/master/UN_MigrantStockFemale_2019.csv)

```{r}
female_migrants <- read_csv("https://raw.githubusercontent.com/igukusamuel/DATA-607-Project-2/master/UN_MigrantStockFemale_2019.csv")

#view(head(female_migrants, 20)) # vIew data frame structure and see how many rows to skip.
```

# As part of data cleanup, skip the first 15 rows that include source information nor relevant to out analysis.

```{r}
female_migrants <- read_csv("https://raw.githubusercontent.com/igukusamuel/DATA-607-Project-2/master/UN_MigrantStockFemale_2019.csv", skip = 15)

head(female_migrants, 20) #Print out first 20 rows to confirm that the data have been loaded correctly.
```

# Careful review of the data shows that column named X6 only includes data for rows related to countries and N/A's for rows relating to regions and regional totals. Thus filtering out all N/As in column X6 will leave us with country data only, which is the basis of out analysis. We first view all the N/As under column X6 to confirm none of them relate to country information.

```{r}
colX6 <- filter(female_migrants, is.na(X6))

a <- length(colX6)

head(colX6, a)

```


# We then exclude all N/A's in column X6 and print out the first 6 rows using the head() function.

```{r}
female_migrants_by_country <- filter(female_migrants, !is.na(X6))

head(female_migrants_by_country)
```

# From the above print out, there is need to rename column X1 and X3 as year and country_to respectively.
```{r}
female_migrants_by_country <- female_migrants_by_country %>% 
        rename(
                year = X1,
                country_to = X3
        )
head(female_migrants_by_country)
```

#The above printout shows a number of irrelevant columns that are not necessary for our analysis. Lets print out the entire column names and delete the unnecessary ones to have a cleaner data set.
```{r}
colnames(female_migrants_by_country)
```

#The above print out reveals that we do not need all column names that start with "X", "Total" or "Other". We delete these columns using the srtarts_with function.

```{r}
female_migrants_by_country <- female_migrants_by_country %>% 
        select(-starts_with("X"), -starts_with("Other"), -starts_with("Total"))

head(female_migrants_by_country)
```

#We use dim() function to have an idea of how many rows and columns we have for our analysis.
```{r}
dim(female_migrants_by_country)
```

# The print out below is a confrimation of the column names. This is what we need for our analysis.

```{r}
colnames(female_migrants_by_country)
```


# GEt the length of the column names to be used in the next line of code.
```{r}
y <- length(colnames(female_migrants_by_country))

y 
```

#Let us use gather() function to gather all columns with country names from the 3rd column spanning the entire length of the columns into a single column and exclude any and all N/As to obtain clean data.
```{r}
no_of_female_migrants_per_country <- gather(female_migrants_by_country, "country_from", "no_of_female_migrants", 3:y, na.rm = TRUE)

no_of_female_migrants_per_country
```

#convert the no_of_migrants data column from characters to doubles for statistical analysis. This we will do using the parse_number() function. Print out using head() function the first 6 rows and confirm this conversion.

```{r}
no_of_female_migrants_per_country$no_of_female_migrants <- parse_number(no_of_female_migrants_per_country$no_of_female_migrants)

clean_female_data <- no_of_female_migrants_per_country

head(clean_female_data)
```

# Let us perform some statistical analysis by:

#Ordering data by country with largest inflow of male migrants

```{r}
female_by_country_to <- clean_female_data %>% 
        group_by(year, country_from, country_to) %>% 
        summarise(total_female_migrants = sum(no_of_female_migrants)) %>% 
        arrange(desc(total_female_migrants))
head(female_by_country_to)
```

#Ordering the data by the total no of male migrants since 1995 to 2019.

```{r}
total_female_migrants_since_1995 <- clean_female_data %>% 
        group_by(country_from, country_to) %>% 
        summarise(total_female_migrants = sum(no_of_female_migrants)) %>% 
        arrange(desc(total_female_migrants))
head(total_female_migrants_since_1995)
```

# Ordering the data by the countries sending out the least number of migrants
```{r}
least_no_female_migrants_from <- clean_female_data %>% 
        group_by(country_from) %>% 
        summarise(total_female_migrants_since_1995 = sum(no_of_female_migrants)) %>% 
        arrange(total_female_migrants_since_1995)
head(least_no_female_migrants_from)
```

#Ordering the data by the countries receiving the largest number of imigrants since 1995.

```{r}
largest_no_female_migrants_to <- clean_female_data %>% 
        group_by(country_to) %>% 
        summarise(total_female_migrants_since_1995 = sum(no_of_female_migrants)) %>% 
        arrange(desc(total_female_migrants_since_1995))
head(largest_no_female_migrants_to)
```

# Ordering the data by the countries receiving the least number of imigrants since 1995.

```{r}
least_no_female_migrants_to <- clean_female_data %>% 
        group_by(country_to) %>% 
        summarise(total_female_migrants_since_1995 = sum(no_of_female_migrants)) %>% 
        arrange(total_female_migrants_since_1995)

head(least_no_female_migrants_to)
```

#Conclusion: 
#The top 5 countries receiving the largest mumber of female migrants are USA, Rusia Federation, Germany, France and United Kingdom.
#The top 5 countries receiving the least mumber of female migrants are Saint Helena, Tivalu, Tokelau, Niue and Micronesia (Fed. States of).